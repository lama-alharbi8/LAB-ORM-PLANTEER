{%extends 'main/base.html'%}

{% block title %}{{ plant.name }}{% endblock %}

{% block content %}
<div class="plant-details-container">

    <div class="plant-main-content">

        <div class="plant-image-section">
            {% if plant.image %}
            <img src="{{ plant.image.url }}" alt="{{ plant.name }}" class="plant-main-image">
            {% else %}
            <div class="no-image">No Image Available</div>
            {% endif %}
        </div>
        <div class="plant-text-section">
            <h1 class="plant-title">{{ plant.name }}</h1>
            <p class="plant-category">{{ plant.get_category_display }}</p>

            <div class="plant-description">
                <p>{{ plant.about|linebreaks }}</p>
            </div>

            <div class="plant-info">
                <p><strong>Native to:</strong><br>
                    {% for country in plant.countries.all %}
                        <a href="{% url 'plants:plants_by_country' country.id %}">{{country.name}}</a>{% if not forloop.last%}, {% endif %}
                    {% endfor %}
                    </p>
                <p><strong>Is Edible:</strong> {{ plant.is_edible|yesno:"Yes,No" }}</p>
                <p><strong>Used For:</strong><br>{{ plant.used_for|linebreaks }}</p>
            </div>
        </div>
    </div>
    {% if request.user.is_staff %}
        <div class="plant-actions mt-5">
            <div class="d-flex gap-3 justify-content-end">
                <a href="/plants/{{ plant.id }}/update/" class="btn btn-outline-success">
                    <i class="fas fa-edit"></i> Update Plant
                </a>
                <a href="/plants/{{ plant.id }}/delete/" class="btn btn-outline-danger"
                onclick="return confirm('Are you sure you want to delete this plant?')">
                    
                    <i class="fas fa-trash"></i> Delete Plant
                </a>
            </div>
        </div>
    {% endif %}
    
    <hr>


    <h2>Comments ({{comments.count}})</h2>

    <div class="d-flex flex-column gap-3 p-3 shadow">
        {% for comment in comments %}
            <div class="d-flex flex-column">
                <h4>{{comment.user.username}}</h4>
                <p>{{comment.comment}}</p>
                <p class="text-muted ">{{comment.created_at}}</p>
            </div>
        
        {% endfor %}

    </div>

    {% if request.user.is_authenticated %}
        <h5 class="fw-bold mt-3">Add Comment</h5>
        <form class="d-flex flex-column gap-2" action="{% url 'plants:add_comment_view' plant.id %}" method="post">
            {% csrf_token %}
            <textarea name="comment" class="form-control" required minlength="3" placeholder="Comment..."></textarea>
            <input type="submit" class="btn btn-success justify-content-end pd" value="Add Comment">
        </form>

    {% else %}
        <div class="p-2 rounded alert  alert-warning mt-4 d-flex flex-column gap-2">
            <p>Only registered users can add reviews</p>
        </div>
    {% endif %}


    <div class="related-plants-section">
    <h2 class="related-plants-title mt-5">Related Plants</h2>

    <div class="row g-4">
        {% for related_plant in related_plants %}
        <div class="col-md-6 col-lg-4">
            <div class="card">
                {% if related_plant.image %}
                <img src="{{ related_plant.image.url }}" class="card-img-top" alt="{{ related_plant.name }}" style="height: 200px; object-fit: cover;">
                {% endif %}
                <div class="card-body">
                    <h5 class="card-title">
                        <a href="{% url 'plants:plant_detail_view' related_plant.id %}" class="text-decoration-none text-dark">
                            {{ related_plant.name }}
                        </a>
                    </h5>
                    <p class="text-muted mb-2">{{ related_plant.about|truncatewords:20 }}</p>
                    <span class="badge bg-success">{{ related_plant.get_category_display }}</span>
                    {% if related_plant.is_edible %}
                    <span class="badge bg-info">Edible</span>
                    {% else %}
                    <span class="badge bg-warning text-dark">Not Edible</span>
                    {% endif %}
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12 text-center py-5">
            <i class="fas fa-seedling fa-3x text-muted mb-3"></i>
            <h4 class="text-muted">No related plants found</h4>
            <p class="text-muted">Try browsing other categories</p>
        </div>
        {% endfor %}
    </div>
</div>
</div>
{% endblock %}